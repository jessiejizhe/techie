<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://jessiejizhe.github.io/techie/CS61A/5-computer_programs/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>CS61A-computer programs - Techie</title>
        <link href="../../css/bootstrap.min.css" rel="stylesheet">
        <link href="../../css/font-awesome.min.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">

        <script src="../../js/jquery-1.10.2.min.js" defer></script>
        <script src="../../js/bootstrap.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="../..">Techie</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="dropdown active">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">CS61A <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../ex-function/" class="dropdown-item">function</a>
</li>
                                    
<li>
    <a href="../ex-recursion/" class="dropdown-item">recursion</a>
</li>
                                    
<li>
    <a href="../ex-sequence/" class="dropdown-item">sequence</a>
</li>
                                    
<li>
    <a href="../ex-tree/" class="dropdown-item">tree</a>
</li>
                                    
<li>
    <a href="../ex-linked_list/" class="dropdown-item">linked_list</a>
</li>
                                    
<li>
    <a href="../1-intro/" class="dropdown-item">CS61A-intro</a>
</li>
                                    
<li>
    <a href="../2-function/" class="dropdown-item">CS61A-function</a>
</li>
                                    
<li>
    <a href="../3-data_abstraction/" class="dropdown-item">CS61A-data abstraction</a>
</li>
                                    
<li>
    <a href="../4-object_oriented/" class="dropdown-item">CS61A-object oriented</a>
</li>
                                    
<li>
    <a href="./" class="dropdown-item active">CS61A-computer programs</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">DevOps <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../devops/git/" class="dropdown-item">git</a>
</li>
                                </ul>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Apache <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../../Apache/Hadoop/" class="dropdown-item">Hadoop</a>
</li>
                                    
<li>
    <a href="../../Apache/MapReduce/" class="dropdown-item">MapReduce</a>
</li>
                                    
<li>
    <a href="../../Apache/HDFS/" class="dropdown-item">HDFS</a>
</li>
                                    
<li>
    <a href="../../Apache/Spark/" class="dropdown-item">Spark</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li class="nav-item">
                                <a rel="prev" href="../4-object_oriented/" class="nav-link">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li class="nav-item">
                                <a rel="next" href="../../devops/git/" class="nav-link">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#computer-programs" class="nav-link">Computer Programs</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#modular-design" class="nav-link">Modular Design</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#exceptions" class="nav-link">Exceptions</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#scheme-programming-language" class="nav-link">Scheme (programming language)</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#programming-languages" class="nav-link">Programming Languages</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#parsing" class="nav-link">Parsing</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#evaluation" class="nav-link">Evaluation</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#interactive-interpreters" class="nav-link">Interactive Interpreters</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#interpreters" class="nav-link">Interpreters</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#declarative-programming" class="nav-link">Declarative Programming</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#binary-numbers" class="nav-link">Binary Numbers</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
            
            <li class="nav-item" data-level="1"><a href="#examples" class="nav-link">Examples</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#restaurant" class="nav-link">Restaurant</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#sql-python" class="nav-link">SQL - Python</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#sql-injection" class="nav-link">SQL Injection</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#blackjack" class="nav-link">BlackJack</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="computer-programs">Computer Programs</h1>
<p>Functions can be manipulated as data using higher-order <strong>functions</strong></p>
<p>Data can be endowed with behavior using Message passing &amp; object system.</p>
<p>Organizing large programs</p>
<ul>
<li>functional abstraction</li>
<li>data abstraction</li>
<li>class inheritance</li>
<li>generic functions</li>
</ul>
<h2 id="modular-design">Modular Design</h2>
<p><strong>Separation of Concerns</strong></p>
<p>A design principle: Isolate different parts of a program that address different concerns a modular component can be developed and tested independently.</p>
<h2 id="exceptions">Exceptions</h2>
<ul>
<li>A built-in mechanism in a programming language to declare and respond to exceptional conditions</li>
<li>Python <strong>raises</strong> an exception whenever an error occurs</li>
<li>Exceptions can be handled by the program, preventing the interpreter from halting</li>
<li>Unhandled exceptions will cause Python to halt execution and print a stack trace</li>
</ul>
<p><strong>Exceptions are objects!</strong></p>
<ul>
<li>They have classes with constructors.</li>
<li>They enable non-local continuation of control</li>
<li>If f calls g and g calls h, exceptions can shift control from h to f without waiting for g to return.</li>
<li>(Exception handling tends to be slow.)</li>
</ul>
<p><strong>Raising Exceptions</strong></p>
<ul>
<li>Assert statements raise an exception of type AssertionError: <code>assert &lt;expression&gt;, &lt;string&gt;</code></li>
<li>Assertions are designed to be used liberally. They can be ignored to increase efficiency by running Python with the "-O" flag; "O" stands for optimized: <code>python3 -O</code>, then you will see</li>
</ul>
<pre><code class="language-python">&gt;&gt;&gt; __debug__
False
&gt;&gt;&gt; assert False, 'Error'
</code></pre>
<ul>
<li>Raise statements <code>raise &lt;expression&gt;</code></li>
<li><code>&lt;expression&gt;</code> must evaluate to a subclass of BaseException or an instance of one</li>
<li>Exceptions are constructed like any other object.<ul>
<li>TypeError -- A function was passed the wrong number/type of argument</li>
<li>NameError -- A name wasn't found</li>
<li>KeyError -- A key wasn't found in a dictionary </li>
<li>RecursionError -- Too many recursive calls</li>
</ul>
</li>
</ul>
<pre><code class="language-python">&gt;&gt;&gt; raise Exception('An error occurred')
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
Exception: an error occurred
</code></pre>
<p>The interpreter will print a <strong><em>stack backtrace</em></strong>, which is a structured block of text that describes the nested set of active function calls in the branch of execution in which the exception was raised.</p>
<p><strong>Handling Exceptions</strong></p>
<p>Try statements handle exceptions</p>
<pre><code class="language-python">try:
 &lt;try suite&gt;
except &lt;exception class&gt; as &lt;name&gt;:
 &lt;except suite&gt;
...
</code></pre>
<p><strong>Execution rule</strong></p>
<ul>
<li>The <code>&lt;try suite&gt;</code> is executed first</li>
<li>If, during the course of executing the <code>&lt;try suite&gt;</code>, an exception is raised that is not handled otherwise, and</li>
<li>If the class of the exception inherits from <code>&lt;exception class&gt;</code>, then</li>
<li>The <code>&lt;except suite&gt;</code> is executed, with <code>&lt;name&gt;</code> bound to the exception</li>
</ul>
<pre><code class="language-python">&gt;&gt;&gt; try:
...     x = 1/0
... except ZeroDivisionError as e:
...     print('handling a', type(e))
...     x = 0
... 
handling a &lt;class 'ZeroDivisionError'&gt;
&gt;&gt;&gt; x
0
</code></pre>
<p>More examples</p>
<pre><code class="language-python">def invert(x):
    &quot;&quot;&quot;Return 1/x

    &gt;&gt;&gt; invert(2)
    Never printed if x is 0
    0.5
    &quot;&quot;&quot;
    result = 1/x  # Raises a ZeroDivisionError if x is 0
    print('Never printed if x is 0')
    return result
</code></pre>
<p>Handle the exception</p>
<pre><code class="language-python">def invert_safe(x):
    &quot;&quot;&quot;Return 1/x, or the string 'divison by zero' if x is 0.

    &gt;&gt;&gt; invert_safe(2)
    Never printed if x is 0
    0.5
    &gt;&gt;&gt; invert_safe(0)
    'division by zero'
    &quot;&quot;&quot;
    try:
        return invert(x)
    except ZeroDivisionError as e:
        print('handled', e)
        return str(e)
</code></pre>
<p>output</p>
<pre><code class="language-python">&gt;&gt;&gt; invert_safe(0)
handled division by zero
'division by zero'
</code></pre>
<p>why do we get "division by zero"?</p>
<pre><code class="language-python">&gt;&gt;&gt; 1/0
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
ZeroDivisionError: division by zero
</code></pre>
<p><strong>Multiple try statements</strong>: Control jumps to the except suite of the most recent try statement that handles that type of exception</p>
<pre><code class="language-python">try:
    ... this line always gets executed ..
    ... maybe this one too ...
except:
    ...
finaly:
    ... this will always run at the end ...
    ... usually for realeasing resources ...
</code></pre>
<h2 id="scheme-programming-language">Scheme (programming language)</h2>
<p>Scheme is a dialect of Lisp, the second-oldest programming language that is still widely used today.</p>
<p><strong>Fundamentals</strong></p>
<ul>
<li>Scheme programs consist of expressions, which can be</li>
<li>Primitive expressions: 2, 3.3, true, +, quotient, ...</li>
<li>Combinations: (quotient 10 2), (not true), ...</li>
<li>Numbers are self-evaluating; symbols are bound to values</li>
<li>Call expressions include an operator and 0 or more operands in parentheses</li>
</ul>
<p><strong>Special Forms</strong></p>
<p>A combination that is not a call expression is a special form:</p>
<ul>
<li><strong>if</strong> expression: <code>(if &lt;predicate&gt; &lt;consequent&gt; &lt;alternative&gt;)</code></li>
<li><strong>and</strong> and <strong>or</strong>: <code>(and &lt;e1&gt; ... &lt;en&gt;)</code>, <code>(or &lt;e1&gt; ... &lt;en&gt;)</code></li>
<li>Binding symbols: <code>(define &lt;symbol&gt; &lt;expression&gt;)</code></li>
<li>New procedures: <code>(define (&lt;symbol&gt; &lt;formal parameters&gt;) &lt;body&gt;)</code></li>
<li>The <code>cond</code> special form that behaves like <code>if-elif-else</code> statements in Python</li>
<li>The <code>begin</code> special form combines multiple expressions into one expression</li>
<li>The <code>let</code> special form binds symbols to values <strong>temporarily</strong>; just for one expression</li>
</ul>
<p><strong>lambda expression</strong></p>
<p>Lambda expressions evaluate to anonymous procedures<code>(lambda (&lt;formal-parameters&gt;) &lt;body&gt;)</code></p>
<p><strong>Scheme Lists</strong></p>
<p>like Python Linked List. In the late 1950s, computer scientists used confusing names</p>
<ul>
<li><code>cons</code>: Two-argument procedure that creates a linked list</li>
<li><code>car</code>: Procedure that returns the first element of a list</li>
<li><code>cdr</code>: Procedure that returns the rest of a list</li>
<li><code>nil</code>: The empty list </li>
</ul>
<p><strong>Symbolic Programming</strong></p>
<ul>
<li>Quotation is used to refer to symbols directly in Lisp</li>
<li>Quotation can also be applied to combinations to form lists</li>
</ul>
<p><strong>Quasiquotation</strong></p>
<h2 id="programming-languages">Programming Languages</h2>
<p><strong>Machine languages</strong>: statements are interpreted by the hardware itself</p>
<ul>
<li>A fixed set of instructions invoke operations implemented by the circuitry of the central processing unit (CPU)</li>
<li>Operations refer to specific hardware memory addresses; no abstraction mechanisms</li>
</ul>
<p><strong>High-level languages</strong>: statements &amp; expressions are interpreted by another program or compiled (translated) into another language</p>
<ul>
<li>Provide means of abstraction such as naming, function definition, and objects</li>
<li>Abstract away system details to be independent of hardware and operating system</li>
</ul>
<p><strong>Metalinguistic Abstraction</strong></p>
<p>A powerful form of abstraction is to define a new language that is tailored to a particular type of application or problem domain</p>
<ul>
<li><strong>Type of application</strong>: Erlang was designed for concurrent programs. It has built-in elements for expressing concurrent communication. It is used, for example, to implement chat servers with many simultaneous connections</li>
<li><strong>Problem domain</strong>: The MediaWiki mark-up language was designed for generating static web pages. It has built-in elements for text formatting and cross-page linking. It is used, for example, to create Wikipedia pages</li>
</ul>
<p>A programming language has</p>
<ul>
<li><strong>Syntax</strong>: The legal statements and expressions in the language </li>
<li><strong>Semantics</strong>: The execution/evaluation rule for those statements and expressions</li>
</ul>
<p>To create a new programming language, you either need a:</p>
<ul>
<li><strong>Specification</strong>: A document describe the precise syntax and semantics of the language</li>
<li><strong>Canonical Implementation</strong>: An interpreter or compiler for the language</li>
</ul>
<h2 id="parsing">Parsing</h2>
<p>A Parser takes text and returns an expression.</p>
<p><em>Text</em> -- <strong>Lexical Analysis</strong> -- <em>Tokens</em> -- <strong>Syntactic Analysis</strong> -- Expression</p>
<ul>
<li><strong>Lexical Analysis</strong></li>
<li>Iterative process</li>
<li>Checks for malformed tokens</li>
<li>Determines types of tokens</li>
<li>Processes one line at a time</li>
<li><strong>Syntactic Analysis</strong></li>
<li>Tree-recursive process</li>
<li>Balances parentheses</li>
<li>Returns tree structure</li>
<li>Processes multiple lines</li>
</ul>
<p><strong>Syntactic Analysis</strong></p>
<ul>
<li>
<p>Syntactic analysis identifies the hierarchical structure of an expression, which may be nested.</p>
</li>
<li>
<p>Each call to scheme_read consumes the input tokens for exactly one expression.</p>
</li>
<li><strong>Base case</strong>: symbols and numbers</li>
<li><strong>Recursive call</strong>: scheme_read sub-expressions and combine them</li>
</ul>
<p>Scheme expressions are represented as Scheme lists.</p>
<p><strong><em>Homoiconic</em></strong> means source code is data.</p>
<h2 id="evaluation">Evaluation</h2>
<p><strong>The Eval Function</strong></p>
<p>The eval function computes the value of an expression, which is always a number.</p>
<p>It is a generic function that dispatches on the type of the expression (primitive or call).</p>
<ul>
<li><strong>Primitive</strong>: a number evaluates... to itself</li>
<li><strong>Call</strong>: a call expression evaluates... to its argument values combined by an operator</li>
</ul>
<pre><code class="language-python">def calc_eval(exp):
    if type(exp) in (int, float):
        return exp
    elif isinstance(exp, Pair):
        arguments = exp.second.map(calc_eval)
        return calc_apply(exp.first, arguments)
    else:
        raise TypeError

def calc_apply(operator, args):
    if operator == '+':
        return reduce(add, args, 0)
    elif operator == '-':
        ...
    elif operator == '*':
        ...
    elif operator == '/':
        ...
    else:
        raise TypeError
</code></pre>
<h2 id="interactive-interpreters">Interactive Interpreters</h2>
<p><strong>Read-Eval-Print Loop</strong></p>
<p>The user interface for many programming languages is an interactive interpreter</p>
<ol>
<li>Print a prompt</li>
<li>Read text input from the user</li>
<li>Parse the text input into an expression</li>
<li>Evaluate the expression</li>
<li>If any errors occur, report those errors, otherwise</li>
<li>Print the value of the expression and repeat</li>
</ol>
<p><strong>Raising Exceptions</strong></p>
<p>Exceptions are raised within lexical analysis, syntactic analysis, eval, and apply.</p>
<ul>
<li><strong>Lexical analysis</strong>: The token 2.3.4 raises ValueError("invalid numeral")</li>
<li><strong>Syntactic analysis</strong>: An extra ) raises SyntaxError("unexpected token")</li>
<li><strong>Eval</strong>: An empty combination raises TypeError("() is not a number or call expression")</li>
<li><strong>Apply</strong>: No arguments to - raises TypeError("- requires at least 1 argument")</li>
</ul>
<p><strong>Handling Exceptions</strong></p>
<p>An interactive interpreter prints information about each error.</p>
<p>A well-designed interactive interpreter should not halt completely on an error, so that the user has an opportunity to try again in the current environment.</p>
<h2 id="interpreters">Interpreters</h2>
<p><strong>The Structure of an Interpreter</strong></p>
<ul>
<li><strong>Eval</strong></li>
<li>Base cases<ul>
<li>Primitive values (numbers)</li>
<li>Look up values bound to symbols</li>
</ul>
</li>
<li>Recursive calls<ul>
<li>Eval(operator, operands) of call expressions • Apply(procedure, arguments)</li>
<li>Eval(sub-expressions) of special forms</li>
</ul>
</li>
<li>Requires an environment for symbol lookup</li>
<li><strong>Apply</strong></li>
<li>Base cases<ul>
<li>Built-in primitive procedures</li>
</ul>
</li>
<li>Recursive calls<ul>
<li>Eval(body) of user-defined procedures</li>
</ul>
</li>
<li>Creates a new environment each time a user-defined procedure is applied</li>
</ul>
<p><strong>Logical Forms</strong></p>
<ul>
<li>if</li>
<li>and / or</li>
<li>cond</li>
</ul>
<p><strong>Quotation</strong></p>
<p>The quote special form evaluates to the quoted expression, which is not evaluated</p>
<p><strong>Lambda Expressions</strong></p>
<p>Lambda expressions evaluate to user-defined procedures</p>
<p><strong>Define</strong></p>
<p>Define binds a symbol to a value in the first frame of the current environment.</p>
<ol>
<li>Evaluate the <code>&lt;expression&gt;</code></li>
<li>Bind <code>&lt;name&gt;</code> to its value in the current frame</li>
</ol>
<h2 id="declarative-programming">Declarative Programming</h2>
<p><strong>Database Management Systems</strong></p>
<ul>
<li>
<p>Database management systems (DBMS) are important, heavily used, and interesting!</p>
</li>
<li>
<p>A table is a collection of records, which are rows that have a value for each column</p>
</li>
<li>The Structured Query Language (SQL) is perhaps the most widely used declarative programming language</li>
</ul>
<p><strong>Declarative vs Imperative</strong></p>
<ul>
<li><strong>Declarative Languages</strong></li>
<li>such as SQL &amp; Prolog</li>
<li>A "program" is a description of the desired result</li>
<li>The interpreter figures out how to generate the result</li>
<li><strong>Imperative Languages</strong></li>
<li>such as Python &amp; Scheme</li>
<li>A "program" is a description of computational processes</li>
<li>The interpreter carries out execution/evaluation rules</li>
</ul>
<h2 id="binary-numbers">Binary Numbers</h2>
<p>2-levels are reliable for fluctuations (imagining how to distinguish water level)</p>
<p><strong>Negative Numbers -- Two's Complement</strong></p>
<ul>
<li>start with an unsigned 4-bit binary number where leftmost bit is 0</li>
<li>0110 = 6</li>
<li>complement your binary number (flip bits)</li>
<li>1001</li>
<li>add one to your binary number</li>
<li>1010 = -6</li>
</ul>
<p>solve the problem of summation of negative and positive numbers in base 2</p>
<p>n-bit signed binary numbers -2^(n-1) ... 2^(n-1) -1</p>
<p><strong>Fraction Numbers</strong></p>
<p>± mantissa x base ^ (± exponent)</p>
<p><strong>Boolean Logic -- Building Gates</strong></p>
<ul>
<li>AND (sequential)</li>
<li>OR (parallel)</li>
<li>NOT (resistor)</li>
</ul>
<p>A <strong>circuit</strong> is a collection of logical gates that transforms a set of binary inputs into a set of
binary outputs.</p>
<h1 id="examples">Examples</h1>
<h2 id="restaurant">Restaurant</h2>
<pre><code class="language-python">def search(query, ranking=lambda r: -r.stars):
    results = [r for r in Restaurant.all if query in r.name]
    return sorted(results, key=ranking)


def num_shared_reviewers(restaurant, other):
    # return fast_overlap(restaurant.reviewers, other.reviewers)
    return len([r for r in restaurant.reviewers if r in other.reviewers])


class Restaurant:
    &quot;&quot;&quot;A restaurant.&quot;&quot;&quot;
    all = []

    def __init__(self, name, stars, reviewers):
        self.name = name
        self.stars = stars
        self.reviewers = reviewers
        Restaurant.all.append(self)

    def similar(self, k, similarity=num_shared_reviewers):
        &quot;Return the K most similar restaurants to SELF, using SIMILARITY for comparison.&quot;
        others = list(Restaurant.all)
        others.remove(self)
        return sorted(others, key=lambda r: -similarity(self, r))[:k]

    def __repr__(self):
        return '&lt;' + self.name + '&gt;'
</code></pre>
<p>load data</p>
<pre><code class="language-python">import json

def load_reviews(reviews_file):
    reviewers_by_restaurant = {}
    for line in open(reviews_file):
        r = json.loads(line)
        business_id = r['business_id']
        if business_id not in reviewers_by_restaurant:
            reviewers_by_restaurant[business_id] = []
        reviewers_by_restaurant[business_id].append(r['user_id'])
    return reviewers_by_restaurant

def load_restaurants(reviewers_by_restaurant, restaurants_file):
    for line in open(restaurants_file):
        b = json.loads(line)
        reviewers = reviewers_by_restaurant.get(b['business_id'], [])
        Restaurant(b['name'], b['stars'], sorted(reviewers))


load_restaurants(load_reviews('reviews.json'), 'restaurants.json')
</code></pre>
<p>improve speed</p>
<pre><code class="language-python">def fast_overlap(s, t):
    &quot;&quot;&quot;Return the overlap between sorted S and sorted T.

    &gt;&gt;&gt; fast_overlap([2, 3, 5, 6, 7], [1, 4, 5, 6, 7, 8])
    3
    &quot;&quot;&quot;
    count, i, j = 0, 0, 0
    while i &lt; len(s) and j &lt; len(t):
        if s[i] == t[j]:
            count, i, j = count + 1, i + 1, j + 1
        elif s[i] &lt; t[j]:
            i += 1
        else:
            j += 1
    return count
</code></pre>
<h2 id="sql-python">SQL - Python</h2>
<pre><code class="language-python">import sqlite3

# SQL Intro

db = sqlite3.Connection(&quot;nums.db&quot;)
db.execute(&quot;CREATE TABLE nums AS SELECT 2 as n UNION SELECT 3;&quot;)
db.execute(&quot;INSERT INTO nums VALUES (?), (?), (?);&quot;, range(4, 7))
print(db.execute(&quot;SELECT * FROM nums;&quot;).fetchall())
db.commit()
</code></pre>
<p><code>db.commit()</code> will create <code>nums.db</code></p>
<p>Next time, execute <code>sqlite3 n.db</code> from command line</p>
<h2 id="sql-injection">SQL Injection</h2>
<pre><code class="language-python">import readline
import sqlite3

db = sqlite3.Connection(&quot;:memory:&quot;)
db.execute(&quot;CREATE TABLE Students(name);&quot;)
db.execute(&quot;INSERT INTO Students VALUES ('John');&quot;)

def add_name(name):
    cmd = &quot;INSERT INTO Students VALUES ('&quot; + name + &quot;');&quot;
    print(&quot;Executing:&quot;, cmd)
    db.executescript(cmd)
    print(&quot;Students:&quot;, db.execute(&quot;select * from Students&quot;).fetchall())

def add_name_safe(name):
    db.execute(&quot;INSERT INTO Students VALUES (?)&quot;, [name])
    print(&quot;Students:&quot;, db.execute(&quot;select * from Students&quot;).fetchall())

add_name_safe(&quot;Jack&quot;)
add_name_safe(&quot;Jill&quot;)
add_name_safe(&quot;Robert'); DROP TABLE Students; --&quot;);
</code></pre>
<h2 id="blackjack">BlackJack</h2>
<pre><code class="language-python">import random
import readline
import sqlite3

points = {'A': 1, 'J': 10, 'Q': 10, 'K':10}
points.update({n: n for n in range(2, 11)})

def hand_score(hand):
    &quot;&quot;&quot;Total score for a hand.&quot;&quot;&quot;
    total = sum([points[card] for card in hand])
    if total &lt;= 11 and 'A' in hand:
        return total + 10
    return total

db = sqlite3.Connection('cards.db')
sql = db.execute
sql('DROP TABLE IF EXISTS cards')
sql('CREATE TABLE cards(card, place);')

def play(card, place):
    &quot;&quot;&quot;Play a card so that the player can see it.&quot;&quot;&quot;
    sql('INSERT INTO cards VALUES (?, ?)', (card, place))
    db.commit()

def score(who):
    &quot;&quot;&quot;Compute the hand score for the player or dealer.&quot;&quot;&quot;
    cards = sql('SELECT * from cards where place = ?;', [who])
    return hand_score([card for card, place in cards.fetchall()])

def bust(who):
    &quot;&quot;&quot;Check if the player or dealer went bust.&quot;&quot;&quot;
    return score(who) &gt; 21

player, dealer = &quot;Player&quot;, &quot;Dealer&quot;

def play_hand(deck):
    &quot;&quot;&quot;Play a hand of Blackjack.&quot;&quot;&quot;
    play(deck.pop(), player)
    play(deck.pop(), dealer)
    play(deck.pop(), player)
    hidden = deck.pop()

    while 'y' in input(&quot;Hit? &quot;).lower():
        play(deck.pop(), player)
        if bust(player):
            print(player, &quot;went bust!&quot;)
            return

    play(hidden, dealer)

    while score(dealer) &lt; 17:
        play(deck.pop(), dealer)
        if bust(dealer):
            print(dealer, &quot;went bust!&quot;)
            return

    print(player, score(player), &quot;and&quot;, dealer, score(dealer))

deck = list(points.keys()) * 4
random.shuffle(deck)
while len(deck) &gt; 10:
    print('\nDealing...')
    play_hand(deck)
    sql('UPDATE cards SET place=&quot;Discard&quot;;')
</code></pre></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "../..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../../js/base.js" defer></script>
        <script src="../../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
